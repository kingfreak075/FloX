<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nuovo Intervento</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,fill,GRAD@24,400,0,0" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body style="background: #f8fafc;">

    <div class="header-app">
        <button onclick="history.back()" class="btn-icon">
            <span class="material-symbols-rounded">arrow_back</span>
        </button>
        <h2>Inserimento Lavoro</h2>
    </div>

    <div class="container" style="padding-top: 80px;">
        <div id="info-impianto-box" class="section-card" style="background: #fff; margin-bottom: 15px;">
            <div id="label-impianto" style="font-size: 0.75rem; color: #64748b; font-weight: 800; text-transform: uppercase;">Impianto</div>
            <div id="display-impianto" style="font-weight: 900; color: #1e293b; font-size: 1.1rem;">-</div>
            <div id="display-indirizzo" style="font-size: 0.85rem; color: #64748b;">-</div>
            
            <input type="text" id="input-commessa" class="input-modern" placeholder="Inserisci 8 caratteri..." maxlength="8" style="display:none; margin-top:10px;">
        </div>

        <div class="section-card" style="background: #fff;">
            
            <label class="label-field">Codice Intervento</label>
            <select id="select-codice" class="input-modern" onchange="handleCodiceChange()">
                <option value="" disabled selected>Scegli codice...</option>
                <option value="21">21 - Manutenzione</option>
                <option value="22">22 - Chiamata</option>
                <option value="24">24 - Assistenza Enti</option>
                <option value="13">13 - Commessa Riparazioni</option>
                <option value="10">10 - Commessa Superiore Q2SA</option>
            </select>

            <div id="box-tipo" style="margin-top: 20px; display: none;">
                <label class="label-field">Tipologia Lavoro</label>
                <div style="display: flex; gap: 10px; margin-top: 5px;">
                    <label class="radio-btn"><input type="radio" name="tipo" value="ORDINARIA" checked onchange="updateUI()"> <span>ORDINARIA</span></label>
                    <label id="label-stra" class="radio-btn"><input type="radio" name="tipo" value="STRAORDINARIO" onchange="updateUI()"> <span>STRAORD.</span></label>
                    <label id="label-rep" class="radio-btn"><input type="radio" name="tipo" value="REPERIBILITA" onchange="updateUI()"> <span>REPERIB.</span></label>
                </div>
            </div>

            <div id="box-ore-dirette" style="margin-top: 20px; display: none;">
                <label class="label-field">Ore Lavoro</label>
                <input type="number" id="ore-ord-manual" class="input-modern" step="0.5" placeholder="Es: 2.5">
            </div>

            <div id="box-orari" style="margin-top: 20px; display: none;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label class="label-field">Inizio</label>
                        <input type="time" id="ora-inizio" class="input-modern" step="900" onchange="calcolaOre()">
                    </div>
                    <div>
                        <label class="label-field">Fine</label>
                        <input type="time" id="ora-fine" class="input-modern" step="900" onchange="calcolaOre()">
                    </div>
                </div>
                
                <div id="preview-calcolo" style="margin-top:15px; padding:10px; background:#f1f5f9; border-radius:8px; font-size:0.85rem; display:none;">
                    <div style="display:flex; align-items:center; gap:5px; font-weight:800; color:#475569;">
                        <span class="material-symbols-rounded" style="font-size:18px;">schedule</span>
                        Calcolo: <span id="res-calcolo">0.0h</span>
                    </div>
                    <div id="split-info" style="font-size:0.75rem; color:#64748b; margin-top:3px;"></div>
                </div>
            </div>

            <div style="margin-top: 20px;">
                <label class="label-field">Ore Viaggio (Indipendenti)</label>
                <input type="number" id="ore-viaggio" class="input-modern" step="0.5" placeholder="Es: 1.0">
            </div>

            <div style="margin-top: 20px;">
                <label class="label-field">Note Intervento</label>
                <textarea id="note" class="input-modern" style="height: 80px;" placeholder="Dettagli intervento..."></textarea>
            </div>

            <div style="margin-top: 20px;">
                <label class="label-field">Data Intervento</label>
                <input type="date" id="data-lavoro" class="input-modern">
            </div>

            <button onclick="salvaIntervento()" class="btn-primary" style="margin-top: 30px; width: 100%;">
                SALVA INTERVENTO
            </button>
        </div>
    </div>

    <script src="nuovo_lavoro.js"></script>
</body>
</html>
