<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dettaglio Impianto - ParkApp</title>
    <link rel="stylesheet" href="style.css">
    <!-- CON QUESTO: -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- ✅ AGGIUNTO: File di configurazione DB centrale -->
<script src="db-config.js"></script>
<script src="check-db-config.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" />
</head>
<body class="bg-app">

    <div class="app-container">
        <header class="app-header" style="display: flex; align-items: center; gap: 15px;">
          <button onclick="window.location.href='parco.html'" class="btn-scheda" style="height: 40px; width: 40px;">
                <span class="material-symbols-rounded">arrow_back</span>
            </button>
            <h1 style="font-size: 1.1rem; font-weight: 800; margin: 0;">Scheda Impianto</h1>
        </header>

        <main id="dettaglio-content" style="padding: 1rem; display: none;">
            
            <section class="section-card">
                <h1 id="det-impianto" style="font-size: 2rem; font-weight: 900; color: var(--primary); margin: 0;">-</h1>
                <p id="det-localita" style="font-size: 1rem; color: var(--text-muted); margin-bottom: 1rem;">-</p>
                <div style="display: flex; gap: 8px;">
                    <span id="badge-manut" class="badge"></span>
                    <span id="badge-tipo" class="badge secondary"></span>
                </div>
            </section>

            <section class="section-card">
                <h3 class="section-title">DATI TECNICI</h3>
                <div class="info-row"><span>Mtr.</span> <strong id="det-matricola">-</strong></div>
                <div class="info-row"><span>Tecnico</span> <strong id="det-tecnico">-</strong></div>
                <div class="info-row"><span>Manutentore</span> <strong id="det-giro">-</strong></div>
                <div class="info-row"><span>Supervisore</span> <strong id="det-supervisore">-</strong></div>
            </section>

            <section class="section-card">
                <h3 class="section-title">PIANIFICAZIONE</h3>
                <div class="info-row"><span>Ultima Semestrale</span> <strong id="det-ult-sem">-</strong></div>
                <div class="info-row"><span>Ultima VP</span> <strong id="det-ult-vp">-</strong></div>
                <div class="info-row"><span>Mese Semestrale</span> <strong id="det-mese-semestre" style="color: var(--primary);">-</strong></div>
                <div class="info-row"><span>Periodicità</span> <strong id="det-periodicita">-</strong></div>
            </section>

            <section class="section-card">
                <h3 class="section-title">AMMINISTRAZIONE</h3>
                <div class="info-row"><span>Cliente</span> <strong id="det-cliente">-</strong></div>
                <div class="info-row"><span>Amministratore</span> <strong id="det-amministratore">-</strong></div>
                <div class="info-row"><span>Venditore</span> <strong id="det-venditore">-</strong></div>
            </section>

            <section class="section-card" style="background-color: #fffef0; border-left: 4px solid #facc15;">
                <h3 class="section-title">NOTE</h3>
                <p id="det-note" style="font-size: 0.9rem; line-height: 1.5; white-space: pre-wrap; margin:0;">-</p>
            </section>

            <button id="btn-nuovo-lavoro" class="btn-action">
                <span class="material-symbols-rounded">add_task</span>
                INSERISCI LAVORO
            </button>
        </main>
    </div>




<script>
    document.addEventListener('DOMContentLoaded', function() {
        const configInfo = getDbConfigInfo();
        
        if (!configInfo.configured) {
            console.warn('Database non configurato per ParkApp');
            mostraIndicatoreDB(false);
        } else {
            console.log('DB configurato:', configInfo.urlShort);
            mostraIndicatoreDB(true);
        }
    });
    
    function mostraIndicatoreDB(isConfigured) {
        const header = document.querySelector('.app-header') || 
                      document.querySelector('header') || 
                      document.querySelector('div[style*="position: sticky"]');
        
        if (!header) return;
        
        // Crea o aggiorna indicatore
        let indicator = document.getElementById('db-status-indicator');
        if (!indicator) {
            indicator = document.createElement('div');
            indicator.id = 'db-status-indicator';
            indicator.style.cssText = `
                position: absolute;
                top: 15px;
                right: 15px;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                border: 2px solid white;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                cursor: pointer;
                z-index: 10;
            `;
            indicator.onclick = function() {
                if (confirm('Database non configurato. Vuoi andare alla configurazione?')) {
                    window.location.href = 'config.html';
                }
            };
            header.style.position = 'relative';
            header.appendChild(indicator);
        }
        
        if (isConfigured) {
            indicator.style.background = '#22c55e'; // Verde
            indicator.title = `DB configurato • ${configInfo.urlShort}`;
            indicator.onclick = null;
        } else {
            indicator.style.background = '#f59e0b'; // Giallo/arancione
            indicator.title = 'Database non configurato - Clicca per configurare';
        }
    }
</script>
    <script src="dettaglio.js"></script>
</body>
</html>